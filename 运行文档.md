# 图片水印工具使用文档

## 项目简介

这是一个基于Java开发的命令行图片水印工具，能够读取图片文件的EXIF信息中的拍摄时间，并将日期作为水印添加到图片上。

## 功能特性

- 自动读取图片EXIF信息中的拍摄时间
- 支持多种图片格式：JPG, JPEG, PNG, TIFF, BMP
- 可自定义字体大小、颜色和位置
- 支持单个文件或整个目录的批量处理
- 自动创建输出目录，保持原文件不变
- 提供详细的处理结果统计

## 环境要求

- **Java 21** 或更高版本
- **Maven 3.9.0+** （用于编译）

### 环境检查

请先确认您的Java和Maven版本：

```bash
# 检查Java版本
java -version

# 检查Maven版本  
mvn -version
```

如果没有安装Maven，请从 [Apache Maven官网](https://maven.apache.org/download.cgi) 下载并配置环境变量。

## 编译和构建

### 1. 编译项目

在项目根目录下运行以下命令：

```bash
mvn clean compile
```

### 2. 打包为可执行JAR

```bash
mvn clean package
```

编译完成后，在 `target` 目录下会生成 `photo-watermark-1.0-SNAPSHOT.jar` 文件。

## 使用方法

### 基本语法

```bash
java -jar target/photo-watermark-1.0-SNAPSHOT.jar -i <输入路径> [选项]
```

### 命令行参数

| 参数 | 长参数 | 必需 | 描述 | 默认值 |
|------|--------|------|------|--------|
| `-i` | `--input` | 是 | 输入图片文件或目录路径 | - |
| `-s` | `--size` | 否 | 字体大小 (1-200) | 24 |
| `-c` | `--color` | 否 | 字体颜色 | white |
| `-p` | `--position` | 否 | 水印位置 | br (右下角) |
| `-h` | `--help` | 否 | 显示帮助信息 | - |

### 颜色格式

支持以下颜色格式：

1. **预定义颜色名称**：
   - 英文：red, green, blue, white, black, yellow, orange, pink
   - 中文：红色, 绿色, 蓝色, 白色, 黑色, 黄色, 橙色, 粉色

2. **十六进制格式**：`#FF0000` (红色)

3. **RGB格式**：`255,0,0` (红色)

### 水印位置

| 位置代码 | 位置描述 | 中文别名 |
|----------|----------|----------|
| `tl` | 左上角 | 左上, 左上角 |
| `tc` | 顶部居中 | 上中, 顶部居中 |
| `tr` | 右上角 | 右上, 右上角 |
| `cl` | 左侧居中 | 左中, 左侧居中 |
| `c` | 居中 | 居中, 中心 |
| `cr` | 右侧居中 | 右中, 右侧居中 |
| `bl` | 左下角 | 左下, 左下角 |
| `bc` | 底部居中 | 下中, 底部居中 |
| `br` | 右下角 | 右下, 右下角 |

## 使用示例

### 1. 基本使用 - 处理单个文件

```bash
java -jar target/photo-watermark-1.0-SNAPSHOT.jar -i photo.jpg
```

### 2. 处理整个目录

```bash
java -jar target/photo-watermark-1.0-SNAPSHOT.jar -i /path/to/photos
```

### 3. 自定义水印样式

```bash
# 设置红色、大字体、左上角位置
java -jar target/photo-watermark-1.0-SNAPSHOT.jar -i photos/ -s 36 -c red -p tl

# 使用RGB颜色值
java -jar target/photo-watermark-1.0-SNAPSHOT.jar -i photos/ -c "255,255,0" -p center

# 使用十六进制颜色
java -jar target/photo-watermark-1.0-SNAPSHOT.jar -i photos/ -c "#00FF00" -p br
```

### 4. 查看帮助信息

```bash
java -jar target/photo-watermark-1.0-SNAPSHOT.jar -h
```

## 输出说明

### 输出目录

程序会自动创建输出目录：

- 如果输入是单个文件：在文件所在目录下创建 `[父目录名]_watermark` 子目录
- 如果输入是目录：在该目录下创建 `[目录名]_watermark` 子目录

### 处理结果

程序会显示每个文件的处理状态：

- `✓` 处理成功
- `⚠` 跳过（无EXIF拍摄时间）
- `✗` 处理失败

最后会显示统计信息：总计、成功、跳过、失败的文件数量。

## 注意事项

1. **EXIF信息**：只有包含EXIF拍摄时间信息的图片才会被处理，其他图片会被跳过。

2. **支持格式**：目前支持 JPG、JPEG、PNG、TIFF、BMP 格式的图片。

3. **文件覆盖**：如果输出目录中已存在同名文件，会被覆盖。

4. **权限要求**：确保程序对输入目录有读取权限，对输出目录有写入权限。

5. **内存使用**：处理大量高分辨率图片时，请确保有足够的内存。

## 故障排除

### 常见错误

1. **"输入路径不存在"**
   - 检查输入路径是否正确
   - 确保路径中没有特殊字符

2. **"无法创建输出目录"**
   - 检查是否有足够的磁盘空间
   - 确保对目标位置有写入权限

3. **"无法读取图片文件"**
   - 确认文件格式是否支持
   - 检查文件是否损坏

4. **"读取EXIF信息失败"**
   - 图片可能没有EXIF信息
   - 文件可能已被处理过，EXIF信息被移除

### 性能优化建议

1. 对于大量图片的批处理，建议分批处理
2. 确保有足够的内存（推荐至少2GB）
3. 使用SSD存储可提高处理速度

## 开发信息

- **开发语言**：Java 11
- **构建工具**：Maven
- **主要依赖**：
  - Apache Commons Imaging (EXIF读取)
  - Apache Commons CLI (命令行解析)

## 版本历史

- **v1.0** - 初始版本
  - 支持基本的水印添加功能
  - 支持EXIF时间读取
  - 支持多种颜色和位置选项
